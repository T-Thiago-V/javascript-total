<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti√≥n de Productos</title>
    <link rel="stylesheet" href="misEstilos.css" />
  </head>
  <body>
    <div class="contenedor">
      <header class="titulo">
        <h1>Administrador de almacenamiento</h1>
      </header>

      <section class="seccion">
        <h2>Agregar nuevo producto</h2>
        <div class="formulario">
          <input type="text" id="nombre" placeholder="Nombre del producto" />
          <input type="number" id="precio" placeholder="Precio" />
          <button onclick="agregarProducto()">Agregar</button>
        </div>
      </section>

      <section class="seccion">
        <h2>Consultar producto por ID</h2>
        <div class="formulario">
          <input type="number" id="consultaID" placeholder="ID a consultar" />
          <button onclick="consultarProducto()">Consultar</button>
        </div>
        <div id="resultadoConsulta"></div>
      </section>

      <section class="seccion">
        <h2>Lista de productos</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Precio</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="productos"></tbody>
        </table>
      </section>
    </div>

    <script>
      const API_URL = "https://643dc08e-6f3a-4194-9ec7-931311a6889b-00-2sice1yj2e93e.worf.replit.dev/productos";

      function cargarProductos() {
        fetch(API_URL)
          .then((response) => response.json())
          .then((data) => {
            const tbody = document.getElementById("productos");
            tbody.innerHTML = "";
            data.forEach((p) => {
              tbody.innerHTML += `
<tr>
<td>${p.id}</td>
<td><input value="${p.nombre}" id="nombre-${p.id}"></td>
<td><input value="${p.precio}" id="precio-${p.id}"></td>
<td>
<button onclick="actualizarProducto(${p.id})">Actualizar</button>
<button onclick="eliminarProducto(${p.id})">Eliminar</button>
</td>
</tr>`;
            });
          });
      }

      function agregarProducto() {
        const nombre = document.getElementById("nombre").value;
        const precio = document.getElementById("precio").value;
        fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nombre, precio }),
        }).then(() => {
          document.getElementById("nombre").value = "";
          document.getElementById("precio").value = "";
          cargarProductos();
        });
      }

      function actualizarProducto(id) {
        const nombre = document.getElementById(`nombre-${id}`).value;
        const precio = parseFloat(
          document.getElementById(`precio-${id}`).value,
        );
        fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nombre, precio }),
        }).then(cargarProductos);
      }

      function eliminarProducto(id) {
        fetch(`${API_URL}/${id}`, { method: "DELETE" }).then(cargarProductos);
      }

      function consultarProducto() {
        const id = document.getElementById("consultaID").value;
        fetch(`${API_URL}/${id}`)
          .then((response) => {
            if (!response.ok) throw new Error("Producto no encontrado");
            return response.json();
          })
          .then((data) => {
            document.getElementById("resultadoConsulta").innerHTML = `
<p><strong>ID:</strong> ${data.id}</p>
<p><strong>Nombre:</strong> ${data.nombre}</p>
<p><strong>Precio:</strong> ${data.precio}</p>
          `;
          })
          .catch(() => {
            document.getElementById("resultadoConsulta").innerText =
              "Producto no encontrado.";
          });
      }

      cargarProductos();
    </script>
  </body>
</html>
